!function(t){"function"==typeof define&&define.amd?define(["jquery"],function(i){t(i,document,window,navigator)}):t(jQuery,document,window,navigator)}(function(t,i,e,s,o){"use strict";var a=0,n=function(){var i,e=s.userAgent,o=/msie\s\d+/i;return e.search(o)>0&&(i=o.exec(e).toString(),i=i.split(" ")[1],i<9)&&(t("html").addClass("lt-ie9"),!0)}();Function.prototype.bind||(Function.prototype.bind=function(t){var i=this,e=[].slice;if("function"!=typeof i)throw new TypeError;var s=e.call(arguments,1),o=function(){if(this instanceof o){var a=function(){};a.prototype=i.prototype;var n=new a,r=i.apply(n,s.concat(e.call(arguments)));return Object(r)===r?r:n}return i.apply(t,s.concat(e.call(arguments)))};return o}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,i){var e;if(null==this)throw new TypeError('"this" is null or not defined');var s=Object(this),o=s.length>>>0;if(0===o)return-1;var a=+i||0;if(Math.abs(a)===1/0&&(a=0),a>=o)return-1;for(e=Math.max(a>=0?a:o-Math.abs(a),0);e<o;){if(e in s&&s[e]===t)return e;e++}return-1});var r='<span class="irs"><span class="irs-line" tabindex="-1"><span class="irs-line-left"></span><span class="irs-line-mid"></span><span class="irs-line-right"></span></span><span class="irs-min">0</span><span class="irs-max">1</span><span class="irs-from">0</span><span class="irs-to">0</span><span class="irs-single">0</span></span><span class="irs-grid"></span><span class="irs-bar"></span>',h='<span class="irs-bar-edge"></span><span class="irs-shadow shadow-single"></span><span class="irs-slider single"></span>',l='<span class="irs-shadow shadow-from"></span><span class="irs-shadow shadow-to"></span><span class="irs-slider from"></span><span class="irs-slider to"></span>',c='<span class="irs-disable-mask"></span>',p=function(s,o,a){this.VERSION="2.1.4",this.input=s,this.plugin_count=a,this.current_plugin=0,this.calc_count=0,this.update_tm=0,this.old_from=0,this.old_to=0,this.old_min_interval=null,this.raf_id=null,this.dragging=!1,this.force_redraw=!1,this.no_diapason=!1,this.is_key=!1,this.is_update=!1,this.is_start=!0,this.is_finish=!1,this.is_active=!1,this.is_resize=!1,this.is_click=!1,this.$cache={win:t(e),body:t(i.body),input:t(s),cont:null,rs:null,min:null,max:null,from:null,to:null,single:null,bar:null,line:null,s_single:null,s_from:null,s_to:null,shad_single:null,shad_from:null,shad_to:null,edge:null,grid:null,grid_labels:[]},this.coords={x_gap:0,x_pointer:0,w_rs:0,w_rs_old:0,w_handle:0,p_gap:0,p_gap_left:0,p_gap_right:0,p_step:0,p_pointer:0,p_handle:0,p_single_fake:0,p_single_real:0,p_from_fake:0,p_from_real:0,p_to_fake:0,p_to_real:0,p_bar_x:0,p_bar_w:0,grid_gap:0,big_num:0,big:[],big_w:[],big_p:[],big_x:[]},this.labels={w_min:0,w_max:0,w_from:0,w_to:0,w_single:0,p_min:0,p_max:0,p_from_fake:0,p_from_left:0,p_to_fake:0,p_to_left:0,p_single_fake:0,p_single_left:0};var n,r,h,l=this.$cache.input,c=l.prop("value");n={type:"single",min:10,max:100,from:null,to:null,step:1,min_interval:0,max_interval:0,drag_interval:!1,values:[],p_values:[],from_fixed:!1,from_min:null,from_max:null,from_shadow:!1,to_fixed:!1,to_min:null,to_max:null,to_shadow:!1,prettify_enabled:!0,prettify_separator:" ",prettify:null,force_edges:!1,keyboard:!1,keyboard_step:5,grid:!1,grid_margin:!0,grid_num:4,grid_snap:!1,hide_min_max:!1,hide_from_to:!1,prefix:"",postfix:"",max_postfix:"",decorate_both:!0,values_separator:" — ",input_values_separator:";",disable:!1,onStart:null,onChange:null,onFinish:null,onUpdate:null},r={type:l.data("type"),min:l.data("min"),max:l.data("max"),from:l.data("from"),to:l.data("to"),step:l.data("step"),min_interval:l.data("minInterval"),max_interval:l.data("maxInterval"),drag_interval:l.data("dragInterval"),values:l.data("values"),from_fixed:l.data("fromFixed"),from_min:l.data("fromMin"),from_max:l.data("fromMax"),from_shadow:l.data("fromShadow"),to_fixed:l.data("toFixed"),to_min:l.data("toMin"),to_max:l.data("toMax"),to_shadow:l.data("toShadow"),prettify_enabled:l.data("prettifyEnabled"),prettify_separator:l.data("prettifySeparator"),force_edges:l.data("forceEdges"),keyboard:l.data("keyboard"),keyboard_step:l.data("keyboardStep"),grid:l.data("grid"),grid_margin:l.data("gridMargin"),grid_num:l.data("gridNum"),grid_snap:l.data("gridSnap"),hide_min_max:l.data("hideMinMax"),hide_from_to:l.data("hideFromTo"),prefix:l.data("prefix"),postfix:l.data("postfix"),max_postfix:l.data("maxPostfix"),decorate_both:l.data("decorateBoth"),values_separator:l.data("valuesSeparator"),input_values_separator:l.data("inputValuesSeparator"),disable:l.data("disable")},r.values=r.values&&r.values.split(",");for(h in r)r.hasOwnProperty(h)&&(r[h]||0===r[h]||delete r[h]);c&&(c=c.split(r.input_values_separator||o.input_values_separator||";"),c[0]&&c[0]==+c[0]&&(c[0]=+c[0]),c[1]&&c[1]==+c[1]&&(c[1]=+c[1]),o&&o.values&&o.values.length?(n.from=c[0]&&o.values.indexOf(c[0]),n.to=c[1]&&o.values.indexOf(c[1])):(n.from=c[0]&&+c[0],n.to=c[1]&&+c[1])),t.extend(n,o),t.extend(n,r),this.options=n,this.validate(),this.result={input:this.$cache.input,slider:null,min:this.options.min,max:this.options.max,from:this.options.from,from_percent:0,from_value:null,to:this.options.to,to_percent:0,to_value:null},this.init()};p.prototype={init:function(t){this.no_diapason=!1,this.coords.p_step=this.convertToPercent(this.options.step,!0),this.target="base",this.toggleInput(),this.append(),this.setMinMax(),t?(this.force_redraw=!0,this.calc(!0),this.callOnUpdate()):(this.force_redraw=!0,this.calc(!0),this.callOnStart()),this.updateScene()},append:function(){var t='<span class="irs js-irs-'+this.plugin_count+'"></span>';this.$cache.input.before(t),this.$cache.input.prop("readonly",!0),this.$cache.cont=this.$cache.input.prev(),this.result.slider=this.$cache.cont,this.$cache.cont.html(r),this.$cache.rs=this.$cache.cont.find(".irs"),this.$cache.min=this.$cache.cont.find(".irs-min"),this.$cache.max=this.$cache.cont.find(".irs-max"),this.$cache.from=this.$cache.cont.find(".irs-from"),this.$cache.to=this.$cache.cont.find(".irs-to"),this.$cache.single=this.$cache.cont.find(".irs-single"),this.$cache.bar=this.$cache.cont.find(".irs-bar"),this.$cache.line=this.$cache.cont.find(".irs-line"),this.$cache.grid=this.$cache.cont.find(".irs-grid"),"single"===this.options.type?(this.$cache.cont.append(h),this.$cache.edge=this.$cache.cont.find(".irs-bar-edge"),this.$cache.s_single=this.$cache.cont.find(".single"),this.$cache.from[0].style.visibility="hidden",this.$cache.to[0].style.visibility="hidden",this.$cache.shad_single=this.$cache.cont.find(".shadow-single")):(this.$cache.cont.append(l),this.$cache.s_from=this.$cache.cont.find(".from"),this.$cache.s_to=this.$cache.cont.find(".to"),this.$cache.shad_from=this.$cache.cont.find(".shadow-from"),this.$cache.shad_to=this.$cache.cont.find(".shadow-to"),this.setTopHandler()),this.options.hide_from_to&&(this.$cache.from[0].style.display="none",this.$cache.to[0].style.display="none",this.$cache.single[0].style.display="none"),this.appendGrid(),this.options.disable?(this.appendDisableMask(),this.$cache.input[0].disabled=!0):(this.$cache.cont.removeClass("irs-disabled"),this.$cache.input[0].disabled=!1,this.bindEvents()),this.options.drag_interval&&(this.$cache.bar[0].style.cursor="ew-resize")},setTopHandler:function(){var t=this.options.min,i=this.options.max,e=this.options.from,s=this.options.to;e>t&&s===i?this.$cache.s_from.addClass("type_last"):s<i&&this.$cache.s_to.addClass("type_last")},changeLevel:function(t){switch(t){case"single":this.coords.p_gap=this.toFixed(this.coords.p_pointer-this.coords.p_single_fake);break;case"from":this.coords.p_gap=this.toFixed(this.coords.p_pointer-this.coords.p_from_fake),this.$cache.s_from.addClass("state_hover"),this.$cache.s_from.addClass("type_last"),this.$cache.s_to.removeClass("type_last");break;case"to":this.coords.p_gap=this.toFixed(this.coords.p_pointer-this.coords.p_to_fake),this.$cache.s_to.addClass("state_hover"),this.$cache.s_to.addClass("type_last"),this.$cache.s_from.removeClass("type_last");break;case"both":this.coords.p_gap_left=this.toFixed(this.coords.p_pointer-this.coords.p_from_fake),this.coords.p_gap_right=this.toFixed(this.coords.p_to_fake-this.coords.p_pointer),this.$cache.s_to.removeClass("type_last"),this.$cache.s_from.removeClass("type_last")}},appendDisableMask:function(){this.$cache.cont.append(c),this.$cache.cont.addClass("irs-disabled")},remove:function(){this.$cache.cont.remove(),this.$cache.cont=null,this.$cache.line.off("keydown.irs_"+this.plugin_count),this.$cache.body.off("touchmove.irs_"+this.plugin_count),this.$cache.body.off("mousemove.irs_"+this.plugin_count),this.$cache.win.off("touchend.irs_"+this.plugin_count),this.$cache.win.off("mouseup.irs_"+this.plugin_count),n&&(this.$cache.body.off("mouseup.irs_"+this.plugin_count),this.$cache.body.off("mouseleave.irs_"+this.plugin_count)),this.$cache.grid_labels=[],this.coords.big=[],this.coords.big_w=[],this.coords.big_p=[],this.coords.big_x=[],cancelAnimationFrame(this.raf_id)},bindEvents:function(){this.no_diapason||(this.$cache.body.on("touchmove.irs_"+this.plugin_count,this.pointerMove.bind(this)),this.$cache.body.on("mousemove.irs_"+this.plugin_count,this.pointerMove.bind(this)),this.$cache.win.on("touchend.irs_"+this.plugin_count,this.pointerUp.bind(this)),this.$cache.win.on("mouseup.irs_"+this.plugin_count,this.pointerUp.bind(this)),this.$cache.line.on("touchstart.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.line.on("mousedown.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.options.drag_interval&&"double"===this.options.type?(this.$cache.bar.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"both")),this.$cache.bar.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"both"))):(this.$cache.bar.on("touchstart.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.bar.on("mousedown.irs_"+this.plugin_count,this.pointerClick.bind(this,"click"))),"single"===this.options.type?(this.$cache.single.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"single")),this.$cache.s_single.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"single")),this.$cache.shad_single.on("touchstart.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.single.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"single")),this.$cache.s_single.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"single")),this.$cache.edge.on("mousedown.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.shad_single.on("mousedown.irs_"+this.plugin_count,this.pointerClick.bind(this,"click"))):(this.$cache.single.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,null)),this.$cache.single.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,null)),this.$cache.from.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"from")),this.$cache.s_from.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"from")),this.$cache.to.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"to")),this.$cache.s_to.on("touchstart.irs_"+this.plugin_count,this.pointerDown.bind(this,"to")),this.$cache.shad_from.on("touchstart.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.shad_to.on("touchstart.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.from.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"from")),this.$cache.s_from.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"from")),this.$cache.to.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"to")),this.$cache.s_to.on("mousedown.irs_"+this.plugin_count,this.pointerDown.bind(this,"to")),this.$cache.shad_from.on("mousedown.irs_"+this.plugin_count,this.pointerClick.bind(this,"click")),this.$cache.shad_to.on("mousedown.irs_"+this.plugin_count,this.pointerClick.bind(this,"click"))),this.options.keyboard&&this.$cache.line.on("keydown.irs_"+this.plugin_count,this.key.bind(this,"keyboard")),n&&(this.$cache.body.on("mouseup.irs_"+this.plugin_count,this.pointerUp.bind(this)),this.$cache.body.on("mouseleave.irs_"+this.plugin_count,this.pointerUp.bind(this))))},pointerMove:function(t){if(this.dragging){var i=t.pageX||t.originalEvent.touches&&t.originalEvent.touches[0].pageX;this.coords.x_pointer=i-this.coords.x_gap,this.calc()}},pointerUp:function(i){this.current_plugin===this.plugin_count&&this.is_active&&(this.is_active=!1,this.$cache.cont.find(".state_hover").removeClass("state_hover"),this.force_redraw=!0,n&&t("*").prop("unselectable",!1),this.updateScene(),this.restoreOriginalMinInterval(),(t.contains(this.$cache.cont[0],i.target)||this.dragging)&&(this.is_finish=!0,this.callOnFinish()),this.dragging=!1)},pointerDown:function(i,e){e.preventDefault();var s=e.pageX||e.originalEvent.touches&&e.originalEvent.touches[0].pageX;2!==e.button&&("both"===i&&this.setTempMinInterval(),i||(i=this.target),this.current_plugin=this.plugin_count,this.target=i,this.is_active=!0,this.dragging=!0,this.coords.x_gap=this.$cache.rs.offset().left,this.coords.x_pointer=s-this.coords.x_gap,this.calcPointerPercent(),this.changeLevel(i),n&&t("*").prop("unselectable",!0),this.$cache.line.trigger("focus"),this.updateScene())},pointerClick:function(t,i){i.preventDefault();var e=i.pageX||i.originalEvent.touches&&i.originalEvent.touches[0].pageX;2!==i.button&&(this.current_plugin=this.plugin_count,this.target=t,this.is_click=!0,this.coords.x_gap=this.$cache.rs.offset().left,this.coords.x_pointer=+(e-this.coords.x_gap).toFixed(),this.force_redraw=!0,this.calc(),this.$cache.line.trigger("focus"))},key:function(t,i){if(!(this.current_plugin!==this.plugin_count||i.altKey||i.ctrlKey||i.shiftKey||i.metaKey)){switch(i.which){case 83:case 65:case 40:case 37:i.preventDefault(),this.moveByKey(!1);break;case 87:case 68:case 38:case 39:i.preventDefault(),this.moveByKey(!0)}return!0}},moveByKey:function(t){var i=this.coords.p_pointer;t?i+=this.options.keyboard_step:i-=this.options.keyboard_step,this.coords.x_pointer=this.toFixed(this.coords.w_rs/100*i),this.is_key=!0,this.calc()},setMinMax:function(){if(this.options){if(this.options.hide_min_max)return this.$cache.min[0].style.display="none",void(this.$cache.max[0].style.display="none");this.options.values.length?(this.$cache.min.html(this.decorate(this.options.p_values[this.options.min])),this.$cache.max.html(this.decorate(this.options.p_values[this.options.max]))):(this.$cache.min.html(this.decorate(this._prettify(this.options.min),this.options.min)),this.$cache.max.html(this.decorate(this._prettify(this.options.max),this.options.max))),this.labels.w_min=this.$cache.min.outerWidth(!1),this.labels.w_max=this.$cache.max.outerWidth(!1)}},setTempMinInterval:function(){var t=this.result.to-this.result.from;null===this.old_min_interval&&(this.old_min_interval=this.options.min_interval),this.options.min_interval=t},restoreOriginalMinInterval:function(){null!==this.old_min_interval&&(this.options.min_interval=this.old_min_interval,this.old_min_interval=null)},calc:function(t){if(this.options&&(this.calc_count++,(10===this.calc_count||t)&&(this.calc_count=0,this.coords.w_rs=this.$cache.rs.outerWidth(!1),this.calcHandlePercent()),this.coords.w_rs)){this.calcPointerPercent();var i=this.getHandleX();switch("click"===this.target&&(this.coords.p_gap=this.coords.p_handle/2,i=this.getHandleX(),this.options.drag_interval?this.target="both_one":this.target=this.chooseHandle(i)),this.target){case"base":var e=(this.options.max-this.options.min)/100,s=(this.result.from-this.options.min)/e,o=(this.result.to-this.options.min)/e;this.coords.p_single_real=this.toFixed(s),this.coords.p_from_real=this.toFixed(s),this.coords.p_to_real=this.toFixed(o),this.coords.p_single_real=this.checkDiapason(this.coords.p_single_real,this.options.from_min,this.options.from_max),this.coords.p_from_real=this.checkDiapason(this.coords.p_from_real,this.options.from_min,this.options.from_max),this.coords.p_to_real=this.checkDiapason(this.coords.p_to_real,this.options.to_min,this.options.to_max),this.coords.p_single_fake=this.convertToFakePercent(this.coords.p_single_real),this.coords.p_from_fake=this.convertToFakePercent(this.coords.p_from_real),this.coords.p_to_fake=this.convertToFakePercent(this.coords.p_to_real),this.target=null;break;case"single":if(this.options.from_fixed)break;this.coords.p_single_real=this.convertToRealPercent(i),this.coords.p_single_real=this.calcWithStep(this.coords.p_single_real),this.coords.p_single_real=this.checkDiapason(this.coords.p_single_real,this.options.from_min,this.options.from_max),this.coords.p_single_fake=this.convertToFakePercent(this.coords.p_single_real);break;case"from":if(this.options.from_fixed)break;this.coords.p_from_real=this.convertToRealPercent(i),this.coords.p_from_real=this.calcWithStep(this.coords.p_from_real),this.coords.p_from_real>this.coords.p_to_real&&(this.coords.p_from_real=this.coords.p_to_real),this.coords.p_from_real=this.checkDiapason(this.coords.p_from_real,this.options.from_min,this.options.from_max),this.coords.p_from_real=this.checkMinInterval(this.coords.p_from_real,this.coords.p_to_real,"from"),this.coords.p_from_real=this.checkMaxInterval(this.coords.p_from_real,this.coords.p_to_real,"from"),this.coords.p_from_fake=this.convertToFakePercent(this.coords.p_from_real);break;case"to":if(this.options.to_fixed)break;this.coords.p_to_real=this.convertToRealPercent(i),this.coords.p_to_real=this.calcWithStep(this.coords.p_to_real),this.coords.p_to_real<this.coords.p_from_real&&(this.coords.p_to_real=this.coords.p_from_real),this.coords.p_to_real=this.checkDiapason(this.coords.p_to_real,this.options.to_min,this.options.to_max),this.coords.p_to_real=this.checkMinInterval(this.coords.p_to_real,this.coords.p_from_real,"to"),this.coords.p_to_real=this.checkMaxInterval(this.coords.p_to_real,this.coords.p_from_real,"to"),this.coords.p_to_fake=this.convertToFakePercent(this.coords.p_to_real);break;case"both":if(this.options.from_fixed||this.options.to_fixed)break;i=this.toFixed(i+.1*this.coords.p_handle),this.coords.p_from_real=this.convertToRealPercent(i)-this.coords.p_gap_left,this.coords.p_from_real=this.calcWithStep(this.coords.p_from_real),this.coords.p_from_real=this.checkDiapason(this.coords.p_from_real,this.options.from_min,this.options.from_max),this.coords.p_from_real=this.checkMinInterval(this.coords.p_from_real,this.coords.p_to_real,"from"),this.coords.p_from_fake=this.convertToFakePercent(this.coords.p_from_real),this.coords.p_to_real=this.convertToRealPercent(i)+this.coords.p_gap_right,this.coords.p_to_real=this.calcWithStep(this.coords.p_to_real),this.coords.p_to_real=this.checkDiapason(this.coords.p_to_real,this.options.to_min,this.options.to_max),this.coords.p_to_real=this.checkMinInterval(this.coords.p_to_real,this.coords.p_from_real,"to"),this.coords.p_to_fake=this.convertToFakePercent(this.coords.p_to_real);break;case"both_one":if(this.options.from_fixed||this.options.to_fixed)break;var a=this.convertToRealPercent(i),n=this.result.from_percent,r=this.result.to_percent,h=r-n,l=h/2,c=a-l,p=a+l;c<0&&(c=0,p=c+h),p>100&&(p=100,c=p-h),this.coords.p_from_real=this.calcWithStep(c),this.coords.p_from_real=this.checkDiapason(this.coords.p_from_real,this.options.from_min,this.options.from_max),this.coords.p_from_fake=this.convertToFakePercent(this.coords.p_from_real),this.coords.p_to_real=this.calcWithStep(p),this.coords.p_to_real=this.checkDiapason(this.coords.p_to_real,this.options.to_min,this.options.to_max),this.coords.p_to_fake=this.convertToFakePercent(this.coords.p_to_real)}"single"===this.options.type?(this.coords.p_bar_x=this.coords.p_handle/2,this.coords.p_bar_w=this.coords.p_single_fake,this.result.from_percent=this.coords.p_single_real,this.result.from=this.convertToValue(this.coords.p_single_real),this.options.values.length&&(this.result.from_value=this.options.values[this.result.from])):(this.coords.p_bar_x=this.toFixed(this.coords.p_from_fake+this.coords.p_handle/2),this.coords.p_bar_w=this.toFixed(this.coords.p_to_fake-this.coords.p_from_fake),this.result.from_percent=this.coords.p_from_real,this.result.from=this.convertToValue(this.coords.p_from_real),this.result.to_percent=this.coords.p_to_real,this.result.to=this.convertToValue(this.coords.p_to_real),this.options.values.length&&(this.result.from_value=this.options.values[this.result.from],this.result.to_value=this.options.values[this.result.to])),this.calcMinMax(),this.calcLabels()}},calcPointerPercent:function(){return this.coords.w_rs?(this.coords.x_pointer<0||isNaN(this.coords.x_pointer)?this.coords.x_pointer=0:this.coords.x_pointer>this.coords.w_rs&&(this.coords.x_pointer=this.coords.w_rs),void(this.coords.p_pointer=this.toFixed(this.coords.x_pointer/this.coords.w_rs*100))):void(this.coords.p_pointer=0)},convertToRealPercent:function(t){var i=100-this.coords.p_handle;return t/i*100},convertToFakePercent:function(t){var i=100-this.coords.p_handle;return t/100*i},getHandleX:function(){var t=100-this.coords.p_handle,i=this.toFixed(this.coords.p_pointer-this.coords.p_gap);return i<0?i=0:i>t&&(i=t),i},calcHandlePercent:function(){"single"===this.options.type?this.coords.w_handle=this.$cache.s_single.outerWidth(!1):this.coords.w_handle=this.$cache.s_from.outerWidth(!1),this.coords.p_handle=this.toFixed(this.coords.w_handle/this.coords.w_rs*100)},chooseHandle:function(t){if("single"===this.options.type)return"single";var i=this.coords.p_from_real+(this.coords.p_to_real-this.coords.p_from_real)/2;return t>=i?this.options.to_fixed?"from":"to":this.options.from_fixed?"to":"from"},calcMinMax:function(){this.coords.w_rs&&(this.labels.p_min=this.labels.w_min/this.coords.w_rs*100,this.labels.p_max=this.labels.w_max/this.coords.w_rs*100)},calcLabels:function(){this.coords.w_rs&&!this.options.hide_from_to&&("single"===this.options.type?(this.labels.w_single=this.$cache.single.outerWidth(!1),this.labels.p_single_fake=this.labels.w_single/this.coords.w_rs*100,this.labels.p_single_left=this.coords.p_single_fake+this.coords.p_handle/2-this.labels.p_single_fake/2,this.labels.p_single_left=this.checkEdges(this.labels.p_single_left,this.labels.p_single_fake)):(this.labels.w_from=this.$cache.from.outerWidth(!1),this.labels.p_from_fake=this.labels.w_from/this.coords.w_rs*100,this.labels.p_from_left=this.coords.p_from_fake+this.coords.p_handle/2-this.labels.p_from_fake/2,this.labels.p_from_left=this.toFixed(this.labels.p_from_left),this.labels.p_from_left=this.checkEdges(this.labels.p_from_left,this.labels.p_from_fake),this.labels.w_to=this.$cache.to.outerWidth(!1),this.labels.p_to_fake=this.labels.w_to/this.coords.w_rs*100,this.labels.p_to_left=this.coords.p_to_fake+this.coords.p_handle/2-this.labels.p_to_fake/2,this.labels.p_to_left=this.toFixed(this.labels.p_to_left),this.labels.p_to_left=this.checkEdges(this.labels.p_to_left,this.labels.p_to_fake),this.labels.w_single=this.$cache.single.outerWidth(!1),this.labels.p_single_fake=this.labels.w_single/this.coords.w_rs*100,this.labels.p_single_left=(this.labels.p_from_left+this.labels.p_to_left+this.labels.p_to_fake)/2-this.labels.p_single_fake/2,this.labels.p_single_left=this.toFixed(this.labels.p_single_left),this.labels.p_single_left=this.checkEdges(this.labels.p_single_left,this.labels.p_single_fake)))},updateScene:function(){this.raf_id&&(cancelAnimationFrame(this.raf_id),this.raf_id=null),clearTimeout(this.update_tm),this.update_tm=null,this.options&&(this.drawHandles(),this.is_active?this.raf_id=requestAnimationFrame(this.updateScene.bind(this)):this.update_tm=setTimeout(this.updateScene.bind(this),300))},drawHandles:function(){this.coords.w_rs=this.$cache.rs.outerWidth(!1),this.coords.w_rs&&(this.coords.w_rs!==this.coords.w_rs_old&&(this.target="base",this.is_resize=!0),(this.coords.w_rs!==this.coords.w_rs_old||this.force_redraw)&&(this.setMinMax(),this.calc(!0),this.drawLabels(),this.options.grid&&(this.calcGridMargin(),this.calcGridLabels()),this.force_redraw=!0,this.coords.w_rs_old=this.coords.w_rs,this.drawShadow()),this.coords.w_rs&&(this.dragging||this.force_redraw||this.is_key)&&((this.old_from!==this.result.from||this.old_to!==this.result.to||this.force_redraw||this.is_key)&&(this.drawLabels(),this.$cache.bar[0].style.left=this.coords.p_bar_x+"%",this.$cache.bar[0].style.width=this.coords.p_bar_w+"%","single"===this.options.type?(this.$cache.s_single[0].style.left=this.coords.p_single_fake+"%",this.$cache.single[0].style.left=this.labels.p_single_left+"%",this.options.values.length?this.$cache.input.prop("value",this.result.from_value):this.$cache.input.prop("value",this.result.from),this.$cache.input.data("from",this.result.from)):(this.$cache.s_from[0].style.left=this.coords.p_from_fake+"%",this.$cache.s_to[0].style.left=this.coords.p_to_fake+"%",(this.old_from!==this.result.from||this.force_redraw)&&(this.$cache.from[0].style.left=this.labels.p_from_left+"%"),(this.old_to!==this.result.to||this.force_redraw)&&(this.$cache.to[0].style.left=this.labels.p_to_left+"%"),this.$cache.single[0].style.left=this.labels.p_single_left+"%",this.options.values.length?this.$cache.input.prop("value",this.result.from_value+this.options.input_values_separator+this.result.to_value):this.$cache.input.prop("value",this.result.from+this.options.input_values_separator+this.result.to),this.$cache.input.data("from",this.result.from),this.$cache.input.data("to",this.result.to)),this.old_from===this.result.from&&this.old_to===this.result.to||this.is_start||this.$cache.input.trigger("change"),this.old_from=this.result.from,this.old_to=this.result.to,this.is_resize||this.is_update||this.is_start||this.is_finish||this.callOnChange(),(this.is_key||this.is_click)&&(this.is_key=!1,this.is_click=!1,this.callOnFinish()),this.is_update=!1,this.is_resize=!1,this.is_finish=!1),this.is_start=!1,this.is_key=!1,this.is_click=!1,this.force_redraw=!1))},drawLabels:function(){if(this.options){var t,i,e,s=this.options.values.length,o=this.options.p_values;if(!this.options.hide_from_to)if("single"===this.options.type)s?(t=this.decorate(o[this.result.from]),this.$cache.single.html(t)):(t=this.decorate(this._prettify(this.result.from),this.result.from),this.$cache.single.html(t)),this.calcLabels(),this.labels.p_single_left<this.labels.p_min+1?this.$cache.min[0].style.visibility="hidden":this.$cache.min[0].style.visibility="visible",this.labels.p_single_left+this.labels.p_single_fake>100-this.labels.p_max-1?this.$cache.max[0].style.visibility="hidden":this.$cache.max[0].style.visibility="visible";else{s?(this.options.decorate_both?(t=this.decorate(o[this.result.from]),t+=this.options.values_separator,t+=this.decorate(o[this.result.to])):t=this.decorate(o[this.result.from]+this.options.values_separator+o[this.result.to]),i=this.decorate(o[this.result.from]),e=this.decorate(o[this.result.to]),this.$cache.single.html(t),this.$cache.from.html(i),this.$cache.to.html(e)):(this.options.decorate_both?(t=this.decorate(this._prettify(this.result.from),this.result.from),t+=this.options.values_separator,t+=this.decorate(this._prettify(this.result.to),this.result.to)):t=this.decorate(this._prettify(this.result.from)+this.options.values_separator+this._prettify(this.result.to),this.result.to),i=this.decorate(this._prettify(this.result.from),this.result.from),e=this.decorate(this._prettify(this.result.to),this.result.to),this.$cache.single.html(t),this.$cache.from.html(i),this.$cache.to.html(e)),this.calcLabels();var a=Math.min(this.labels.p_single_left,this.labels.p_from_left),n=this.labels.p_single_left+this.labels.p_single_fake,r=this.labels.p_to_left+this.labels.p_to_fake,h=Math.max(n,r);this.labels.p_from_left+this.labels.p_from_fake>=this.labels.p_to_left?(this.$cache.from[0].style.visibility="hidden",this.$cache.to[0].style.visibility="hidden",this.$cache.single[0].style.visibility="visible",this.result.from===this.result.to?("from"===this.target?this.$cache.from[0].style.visibility="visible":"to"===this.target?this.$cache.to[0].style.visibility="visible":this.target||(this.$cache.from[0].style.visibility="visible"),this.$cache.single[0].style.visibility="hidden",h=r):(this.$cache.from[0].style.visibility="hidden",this.$cache.to[0].style.visibility="hidden",this.$cache.single[0].style.visibility="visible",h=Math.max(n,r))):(this.$cache.from[0].style.visibility="visible",this.$cache.to[0].style.visibility="visible",this.$cache.single[0].style.visibility="hidden"),a<this.labels.p_min+1?this.$cache.min[0].style.visibility="hidden":this.$cache.min[0].style.visibility="visible",h>100-this.labels.p_max-1?this.$cache.max[0].style.visibility="hidden":this.$cache.max[0].style.visibility="visible"}}},drawShadow:function(){var t,i,e,s,o=this.options,a=this.$cache,n="number"==typeof o.from_min&&!isNaN(o.from_min),r="number"==typeof o.from_max&&!isNaN(o.from_max),h="number"==typeof o.to_min&&!isNaN(o.to_min),l="number"==typeof o.to_max&&!isNaN(o.to_max);"single"===o.type?o.from_shadow&&(n||r)?(t=this.convertToPercent(n?o.from_min:o.min),i=this.convertToPercent(r?o.from_max:o.max)-t,t=this.toFixed(t-this.coords.p_handle/100*t),i=this.toFixed(i-this.coords.p_handle/100*i),t+=this.coords.p_handle/2,a.shad_single[0].style.display="block",a.shad_single[0].style.left=t+"%",a.shad_single[0].style.width=i+"%"):a.shad_single[0].style.display="none":(o.from_shadow&&(n||r)?(t=this.convertToPercent(n?o.from_min:o.min),i=this.convertToPercent(r?o.from_max:o.max)-t,t=this.toFixed(t-this.coords.p_handle/100*t),i=this.toFixed(i-this.coords.p_handle/100*i),t+=this.coords.p_handle/2,a.shad_from[0].style.display="block",a.shad_from[0].style.left=t+"%",a.shad_from[0].style.width=i+"%"):a.shad_from[0].style.display="none",o.to_shadow&&(h||l)?(e=this.convertToPercent(h?o.to_min:o.min),s=this.convertToPercent(l?o.to_max:o.max)-e,e=this.toFixed(e-this.coords.p_handle/100*e),s=this.toFixed(s-this.coords.p_handle/100*s),e+=this.coords.p_handle/2,a.shad_to[0].style.display="block",a.shad_to[0].style.left=e+"%",a.shad_to[0].style.width=s+"%"):a.shad_to[0].style.display="none")},callOnStart:function(){this.options.onStart&&"function"==typeof this.options.onStart&&this.options.onStart(this.result)},callOnChange:function(){this.options.onChange&&"function"==typeof this.options.onChange&&this.options.onChange(this.result)},callOnFinish:function(){this.options.onFinish&&"function"==typeof this.options.onFinish&&this.options.onFinish(this.result)},callOnUpdate:function(){this.options.onUpdate&&"function"==typeof this.options.onUpdate&&this.options.onUpdate(this.result)},toggleInput:function(){this.$cache.input.toggleClass("irs-hidden-input")},convertToPercent:function(t,i){var e,s,o=this.options.max-this.options.min,a=o/100;return o?(e=i?t:t-this.options.min,s=e/a,this.toFixed(s)):(this.no_diapason=!0,0)},convertToValue:function(t){var i,e,s=this.options.min,o=this.options.max,a=s.toString().split(".")[1],n=o.toString().split(".")[1],r=0,h=0;if(0===t)return this.options.min;if(100===t)return this.options.max;a&&(i=a.length,r=i),n&&(e=n.length,r=e),i&&e&&(r=i>=e?i:e),s<0&&(h=Math.abs(s),s=+(s+h).toFixed(r),o=+(o+h).toFixed(r));var l,c=(o-s)/100*t+s,p=this.options.step.toString().split(".")[1];return p?c=+c.toFixed(p.length):(c/=this.options.step,c*=this.options.step,c=+c.toFixed(0)),h&&(c-=h),l=p?+c.toFixed(p.length):this.toFixed(c),l<this.options.min?l=this.options.min:l>this.options.max&&(l=this.options.max),l},calcWithStep:function(t){var i=Math.round(t/this.coords.p_step)*this.coords.p_step;return i>100&&(i=100),100===t&&(i=100),this.toFixed(i)},checkMinInterval:function(t,i,e){var s,o,a=this.options;return a.min_interval?(s=this.convertToValue(t),o=this.convertToValue(i),"from"===e?o-s<a.min_interval&&(s=o-a.min_interval):s-o<a.min_interval&&(s=o+a.min_interval),this.convertToPercent(s)):t},checkMaxInterval:function(t,i,e){var s,o,a=this.options;return a.max_interval?(s=this.convertToValue(t),o=this.convertToValue(i),"from"===e?o-s>a.max_interval&&(s=o-a.max_interval):s-o>a.max_interval&&(s=o+a.max_interval),
this.convertToPercent(s)):t},checkDiapason:function(t,i,e){var s=this.convertToValue(t),o=this.options;return"number"!=typeof i&&(i=o.min),"number"!=typeof e&&(e=o.max),s<i&&(s=i),s>e&&(s=e),this.convertToPercent(s)},toFixed:function(t){return t=t.toFixed(9),+t},_prettify:function(t){return this.options.prettify_enabled?this.options.prettify&&"function"==typeof this.options.prettify?this.options.prettify(t):this.prettify(t):t},prettify:function(t){var i=t.toString();return i.replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1"+this.options.prettify_separator)},checkEdges:function(t,i){return this.options.force_edges?(t<0?t=0:t>100-i&&(t=100-i),this.toFixed(t)):this.toFixed(t)},validate:function(){var t,i,e=this.options,s=this.result,o=e.values,a=o.length;if("string"==typeof e.min&&(e.min=+e.min),"string"==typeof e.max&&(e.max=+e.max),"string"==typeof e.from&&(e.from=+e.from),"string"==typeof e.to&&(e.to=+e.to),"string"==typeof e.step&&(e.step=+e.step),"string"==typeof e.from_min&&(e.from_min=+e.from_min),"string"==typeof e.from_max&&(e.from_max=+e.from_max),"string"==typeof e.to_min&&(e.to_min=+e.to_min),"string"==typeof e.to_max&&(e.to_max=+e.to_max),"string"==typeof e.keyboard_step&&(e.keyboard_step=+e.keyboard_step),"string"==typeof e.grid_num&&(e.grid_num=+e.grid_num),e.max<e.min&&(e.max=e.min),a)for(e.p_values=[],e.min=0,e.max=a-1,e.step=1,e.grid_num=e.max,e.grid_snap=!0,i=0;i<a;i++)t=+o[i],isNaN(t)?t=o[i]:(o[i]=t,t=this._prettify(t)),e.p_values.push(t);("number"!=typeof e.from||isNaN(e.from))&&(e.from=e.min),("number"!=typeof e.to||isNaN(e.from))&&(e.to=e.max),"single"===e.type?(e.from<e.min&&(e.from=e.min),e.from>e.max&&(e.from=e.max)):((e.from<e.min||e.from>e.max)&&(e.from=e.min),(e.to>e.max||e.to<e.min)&&(e.to=e.max),e.from>e.to&&(e.from=e.to)),("number"!=typeof e.step||isNaN(e.step)||!e.step||e.step<0)&&(e.step=1),("number"!=typeof e.keyboard_step||isNaN(e.keyboard_step)||!e.keyboard_step||e.keyboard_step<0)&&(e.keyboard_step=5),"number"==typeof e.from_min&&e.from<e.from_min&&(e.from=e.from_min),"number"==typeof e.from_max&&e.from>e.from_max&&(e.from=e.from_max),"number"==typeof e.to_min&&e.to<e.to_min&&(e.to=e.to_min),"number"==typeof e.to_max&&e.from>e.to_max&&(e.to=e.to_max),s&&(s.min!==e.min&&(s.min=e.min),s.max!==e.max&&(s.max=e.max),(s.from<s.min||s.from>s.max)&&(s.from=e.from),(s.to<s.min||s.to>s.max)&&(s.to=e.to)),("number"!=typeof e.min_interval||isNaN(e.min_interval)||!e.min_interval||e.min_interval<0)&&(e.min_interval=0),("number"!=typeof e.max_interval||isNaN(e.max_interval)||!e.max_interval||e.max_interval<0)&&(e.max_interval=0),e.min_interval&&e.min_interval>e.max-e.min&&(e.min_interval=e.max-e.min),e.max_interval&&e.max_interval>e.max-e.min&&(e.max_interval=e.max-e.min)},decorate:function(t,i){var e="",s=this.options;return s.prefix&&(e+=s.prefix),e+=t,s.max_postfix&&(s.values.length&&t===s.p_values[s.max]?(e+=s.max_postfix,s.postfix&&(e+=" ")):i===s.max&&(e+=s.max_postfix,s.postfix&&(e+=" "))),s.postfix&&(e+=s.postfix),e},updateFrom:function(){this.result.from=this.options.from,this.result.from_percent=this.convertToPercent(this.result.from),this.options.values&&(this.result.from_value=this.options.values[this.result.from])},updateTo:function(){this.result.to=this.options.to,this.result.to_percent=this.convertToPercent(this.result.to),this.options.values&&(this.result.to_value=this.options.values[this.result.to])},updateResult:function(){this.result.min=this.options.min,this.result.max=this.options.max,this.updateFrom(),this.updateTo()},appendGrid:function(){if(this.options.grid){var t,i,e,s,o,a=this.options,n=a.max-a.min,r=a.grid_num,h=0,l=0,c=4,p=0,d="";for(this.calcGridMargin(),a.grid_snap?(r=n/a.step,h=this.toFixed(a.step/(n/100))):h=this.toFixed(100/r),r>4&&(c=3),r>7&&(c=2),r>14&&(c=1),r>28&&(c=0),t=0;t<r+1;t++){for(e=c,l=this.toFixed(h*t),l>100&&(l=100,e-=2,e<0&&(e=0)),this.coords.big[t]=l,s=(l-h*(t-1))/(e+1),i=1;i<=e&&0!==l;i++)p=this.toFixed(l-s*i),d+='<span class="irs-grid-pol small" style="left: '+p+'%"></span>';d+='<span class="irs-grid-pol" style="left: '+l+'%"></span>',o=this.convertToValue(l),o=a.values.length?a.p_values[o]:this._prettify(o),d+='<span class="irs-grid-text js-grid-text-'+t+'" style="left: '+l+'%">'+o+"</span>"}this.coords.big_num=Math.ceil(r+1),this.$cache.cont.addClass("irs-with-grid"),this.$cache.grid.html(d),this.cacheGridLabels()}},cacheGridLabels:function(){var t,i,e=this.coords.big_num;for(i=0;i<e;i++)t=this.$cache.grid.find(".js-grid-text-"+i),this.$cache.grid_labels.push(t);this.calcGridLabels()},calcGridLabels:function(){var t,i,e=[],s=[],o=this.coords.big_num;for(t=0;t<o;t++)this.coords.big_w[t]=this.$cache.grid_labels[t].outerWidth(!1),this.coords.big_p[t]=this.toFixed(this.coords.big_w[t]/this.coords.w_rs*100),this.coords.big_x[t]=this.toFixed(this.coords.big_p[t]/2),e[t]=this.toFixed(this.coords.big[t]-this.coords.big_x[t]),s[t]=this.toFixed(e[t]+this.coords.big_p[t]);for(this.options.force_edges&&(e[0]<-this.coords.grid_gap&&(e[0]=-this.coords.grid_gap,s[0]=this.toFixed(e[0]+this.coords.big_p[0]),this.coords.big_x[0]=this.coords.grid_gap),s[o-1]>100+this.coords.grid_gap&&(s[o-1]=100+this.coords.grid_gap,e[o-1]=this.toFixed(s[o-1]-this.coords.big_p[o-1]),this.coords.big_x[o-1]=this.toFixed(this.coords.big_p[o-1]-this.coords.grid_gap))),this.calcGridCollision(2,e,s),this.calcGridCollision(4,e,s),t=0;t<o;t++)i=this.$cache.grid_labels[t][0],i.style.marginLeft=-this.coords.big_x[t]+"%"},calcGridCollision:function(t,i,e){var s,o,a,n=this.coords.big_num;for(s=0;s<n&&(o=s+t/2,!(o>=n));s+=t)a=this.$cache.grid_labels[o][0],e[s]<=i[o]?a.style.visibility="visible":a.style.visibility="hidden"},calcGridMargin:function(){this.options.grid_margin&&(this.coords.w_rs=this.$cache.rs.outerWidth(!1),this.coords.w_rs&&("single"===this.options.type?this.coords.w_handle=this.$cache.s_single.outerWidth(!1):this.coords.w_handle=this.$cache.s_from.outerWidth(!1),this.coords.p_handle=this.toFixed(this.coords.w_handle/this.coords.w_rs*100),this.coords.grid_gap=this.toFixed(this.coords.p_handle/2-.1),this.$cache.grid[0].style.width=this.toFixed(100-this.coords.p_handle)+"%",this.$cache.grid[0].style.left=this.coords.grid_gap+"%"))},update:function(i){this.input&&(this.is_update=!0,this.options.from=this.result.from,this.options.to=this.result.to,this.options=t.extend(this.options,i),this.validate(),this.updateResult(i),this.toggleInput(),this.remove(),this.init(!0))},reset:function(){this.input&&(this.updateResult(),this.update())},destroy:function(){this.input&&(this.toggleInput(),this.$cache.input.prop("readonly",!1),t.data(this.input,"ionRangeSlider",null),this.remove(),this.input=null,this.options=null)}},t.fn.ionRangeSlider=function(i){return this.each(function(){t.data(this,"ionRangeSlider")||t.data(this,"ionRangeSlider",new p(this,i,(a++)))})},function(){for(var t=0,i=["ms","moz","webkit","o"],s=0;s<i.length&&!e.requestAnimationFrame;++s)e.requestAnimationFrame=e[i[s]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[i[s]+"CancelAnimationFrame"]||e[i[s]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(i,s){var o=(new Date).getTime(),a=Math.max(0,16-(o-t)),n=e.setTimeout(function(){i(o+a)},a);return t=o+a,n}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(t){clearTimeout(t)})}()}),function(){var t=function(i){console.log("data",i),this.currentPageIndex=0,this.allPageCount=0,i.width=i.width*i.ratioWidth,i.height=i.height*i.ratioHeight,this._bookData=i,this.pageList=[],this.isAutoZoom=!1,this.zoomScale=1;for(var e=0;e<1;e++)this.initTemplate(e);this.initSilider(),this.init(),this.touchRectSize=new t.Size(this.width/4,this.height/4)};t.Point=function(t,i){return{x:t,y:i}},t.Size=function(t,i){return{width:t,height:i}},t.TouchPostion={LeftTop:0,LeftBottom:1,RightTop:2,RightBottom:3};var i,e="transform",s="-ms-transform",o="-moz-transform",a="-webkit-transform",n="-o-transform";t.prototype.init=function(t){t=t||this._bookData,this._bookData=t,this._bookData||(this._bookData=t),this.width=t.width,this.height=t.height,this.startIndex=t.startIndex,this.editUrl=t.editUrl,this.ratioWidth=t.ratioWidth||1,this.ratioHeight=t.ratioHeight||1,i=this.getPrefix(),t.zoomScale&&(this.zoomScale=t.zoomScale),this._isSinglePage=t.isSinglePage,this.startKeyboard=t.startKeyboard;var e=$(t.container);this.container=e;var s=e.children();this.OriginChildren=s,"auto"==this._isSinglePage&&this.isSinglePage()&&this.autoZoom(),this._onFlipEndPage=t.onFlipEndPage,this._onInitComplete=t.onInitComplete;this.isAutoZoom?(window.innerHeight-this.height)/2:this.getBigRectWidth()-this.height;e.width(this.width*(this.isSinglePage()?1:2)),this.fbStage=$('<div class="FBStage"></div>');var o=this.fbStage;o.width(this.width*(this.isSinglePage()?1:2)).height(this.height);var a=this;if(this.allPageCount=t.allPageCount,s.each(function(t,i){a.addPage.call(a,i)}),this.isSinglePage()){var n=$('<div class="FBBlankPage"></div>').width(t.width).height(t.height);this._BlankPage=this.generatePage(n),this.fbStage.append(this._BlankPage)}this._pageShadow=$('<div class="FBPageShadow"></div>'),this._pageShadow.width(this.width*(this.isSinglePage()?1:2)).height(this.height),o.append(this._pageShadow),this.pageList[this.currentPageIndex].css("z-index",9),e.append(o),this.initEvent(),this._onInitComplete&&this._onInitComplete.call(this)},t.prototype.autoZoom=function(){var t=window.innerWidth/this.width;window.innerHeight/this.height;this.width*=t,this.height*=t,console.log("this.width",document.documentElement.clientWidth),this.OriginChildren.each(function(){$(this).css("transform-origin","center center 0px").css("transform","scale("+t+")"),$(this).css("-webkit-transform-origin","center center 0px").css("-webkit-transform","scale("+t+")"),$(this).css("-ms-transform-origin","center center 0px").css("-ms-transform","scale("+t+")"),$(this).css("-moz-transform-origin","center center 0px").css("-moz-transform","scale("+t+")"),$(this).css("-o-transform-origin","center center 0px").css("-o-transform","scale("+t+")")}),this.isAutoZoom=!0,console.log("this.zoomScale",t),this.zoomScale=t;var i=this._bookData,e=this;$("#bookShadow").css({width:i.width*e.zoomScale+"px",height:i.height*e.zoomScale+"px"}),$("#main,#pageList").css({width:1==e.zoomScale?2*i.width+"px":i.width*e.zoomScale+"px",height:1==e.zoomScale?i.height+"px":i.height*e.zoomScale+"px"})},t.prototype.generatePage=function(t){var i=$('<div class="FBPage" ></div>');i.css("left",this.width*(this.isSinglePage()?0:1)+"px").css("z-index",0),i.FBContainer=$('<div class="FBPageContainer"></div>'),i.FBContainer.width(this.getBigRectWidth()).height(this.getBigRectWidth()),this.isNext?i.width(this.width).height(this.height).append(i.FBContainer).appendTo(this.fbStage):i.width(this.width).height(this.height).append(i.FBContainer).prependTo(this.fbStage),i.FBPage=$('<div class="FBInnerPage"></div>'),i.FBPage.width(this.width).height(this.height),i.OriginPage=$(t),(this.isAutoZoom||1!=this.zoomScale)&&($(t).css("transform-origin-origin","0% 0%").css("transform","scale("+this.zoomScale+")"),$(t).css("-webkit-transform-origin","0% 0%").css("-webkit-transform","scale("+this.zoomScale+")"),$(t).css("-ms-transform-origin","0% 0%").css("-ms-transform","scale("+this.zoomScale+")"),$(t).css("-moz-transform-origin","0% 0%").css("-moz-transform","scale("+this.zoomScale+")"),$(t).css("-o-transform-origin","0% 0%").css("-o-transform","scale("+this.zoomScale+")")),i.FBPage.append(i.OriginPage).appendTo(i.FBContainer);var e=$('<div class="FBPageLight"></div>');return e.width(this.width).height(this.height),i.FBLight=e,i.FBPage.append(e),i},t.prototype.isSinglePage=function(){return void 0!=this._isSinglePage&&"auto"!=this._isSinglePage?!!this._isSinglePage:window.innerHeight>window.innerWidth},t.prototype.getReferencePoint=function(i){var e=this.touchRectSize,s=this.isSinglePage()?1:2;return i.x>this.width*s-e.width&&i.x<=this.width*s&&i.y>=0&&i.y<e.height?{x:this.width*s,y:0,direct:t.TouchPostion.RightTop}:i.x>this.width*s-e.width&&i.x<=this.width*s&&i.y>this.height-e.height&&i.y<=this.height?{x:this.width*s,y:this.height,direct:t.TouchPostion.RightBottom}:i.x>=0&&i.x<e.width&&i.y>=0&&i.y<e.height?{x:0,y:0,direct:t.TouchPostion.LeftTop}:i.x>=0&&i.x<e.width&&i.y>this.height-e.height&&i.y<=this.height?{x:0,y:this.height,direct:t.TouchPostion.LeftBottom}:null},t.prototype.initEvent=function(){var t=!1,i=!1,e=this,s=function(s){if(!i){t=!0;var o=e.getStagePoint(s);e._onTouches.call(e,o,0)}return!1},o=function(s){if(t&&!i){var o=e.getStagePoint(s);e._onTouches.call(e,o,1)}return!1},a=function(s){if(t&&(t=!1,!i)){i=!0;var o=e.getStagePoint(s),a=e._referPoint;if(!a)return i=!1,!1;var n=e.getTwoPointLong(o,a),r=a,h=!1;n>e.getBigRectWidth()/20&&(r={x:e.isSinglePage()?-e.width:0,y:a.y},0==a.x&&(r.x=2*e.width),h=!0);var l=30,c=(r.x-o.x)/l,p=(r.y-o.y)/l,d=0,g=setInterval(function(){i=!0,o={x:o.x+c,y:o.y+p};var t=!1;(Math.abs(Math.abs(o.x)-Math.abs(r.x))<=Math.abs(c)||Math.abs(Math.abs(o.y)-Math.abs(r.y))<=Math.abs(p))&&(o.x=r.x,o.y=r.y,clearInterval(g),t=!0),e._onTouches.call(e,o,1),t&&h&&(0==a.direct||1==a.direct?e.currentPageIndex-=e.isSinglePage()?1:2:e.currentPageIndex+=e.isSinglePage()?1:2,e.currentPageIndex<0?e.currentPageIndex=0:e.currentPageIndex>=e.allPageCount&&(e.currentPageIndex=e.isSinglePage()?e.allPageCount-1:e.allPageCount),e.onPageFlipEnd?e.onPageFlipEnd.call(e):null,e._onFlipEndPage?e._onFlipEndPage.call(e):null),t&&(i=!1)},d)}},n=this.keyTouch=function(t){if(!i){var s={x:t.x,y:t.y};if(e._onTouches.call(e,s,0),e._onTouches.call(e,s,1),!i){i=!0;var o=e._referPoint;if(!o)return i=!1,!1;var a=e.getTwoPointLong(s,o),n=o,r=!1;a>e.getBigRectWidth()/8&&(n={x:e.isSinglePage()?-e.width:0,y:o.y},0==o.x&&(n.x=2*e.width),r=!0);var h=15,l=(n.x-s.x)/h,c=(n.y-s.y)/h,p=20,d=setInterval(function(){i=!0,s={x:s.x+l,y:s.y+c};var t=!1;(Math.abs(Math.abs(s.x)-Math.abs(n.x))<=Math.abs(l)||Math.abs(Math.abs(s.y)-Math.abs(n.y))<=Math.abs(c))&&(s.x=n.x,s.y=n.y,clearInterval(d),t=!0),e._onTouches.call(e,s,1),t&&r&&(0==o.direct||1==o.direct?e.currentPageIndex-=e.isSinglePage()?1:2:e.currentPageIndex+=e.isSinglePage()?1:2,e.currentPageIndex<0?e.currentPageIndex=0:e.currentPageIndex>=e.allPageCount&&(e.currentPageIndex=e.isSinglePage()?e.allPageCount-1:e.allPageCount),e.onPageFlipEnd?e.onPageFlipEnd.call(e):null,e._onFlipEndPage?e._onFlipEndPage.call(e):null),t&&(i=!1)},p)}}},r=function(t){if(console.log("key",e),console.log("key1",t),e.startKeyboard){var i=37,s=39;if(!(e.currentPageIndex>=e.allPageCount&&39==t.keyCode||0==e.currentPageIndex&&37==t.keyCode))switch(console.log("t",e.height),t.stopPropagation(),t.keyCode){case i:var o={x:100*e.ratioWidth,y:e.height-150*e.ratioHeight};n(o);break;case s:var o={x:2*e.width-100*e.ratioWidth,y:e.height-150*e.ratioHeight};n(o)}}};this.fbStage.on("mousedown",s),this.container.on("mousemove",o),this.container.on("mouseup",a),this.fbStage.on("touchstart",s),this.container.on("touchmove",o),this.container.on("touchend",a),$("body").on("keydown",r)},t.prototype.addPage=function(t,i){var e=t;if("string"==typeof t&&(e=$(t)),!this.pageList[i]){var s=this.generatePage.call(this,e);s.addClass("FBPage-"+i||0),1==arguments.length?this.pageList.push(s):this.isNext===!0||this.isNext===!1?this.pageList[i]=s:console.warn("Replace page index is %d, but all page count is %d. add page failed.",i,this.allPageCount)}},t.prototype.deletePageDom=function(t,i){t>=0&&t<=this.allPageCount?this.pageList[t]&&("function"==typeof i?i(this.pageList[t]):this.pageList[t].remove(),this.pageList[t]=null):console.warn("Delete page index is %d, but all page count is %d. delete page failed.",t,this.allPageCount)},t.prototype._onTouches=function(t,i){if(2==i);else{var e;if(0==i?(e=this.getReferencePoint(t),this._referPoint=e):e=this._referPoint,e){var s=this.culCoreData(t,e);if(!this.checkIsValidMove(e,t,s.xDistance))return!1;var o=this.getCurrentCutPageData(s.angle,s.containerMove,s.pageMove,s.distance,t);this.isSinglePage()?(o.isNext&&this.currentPageIndex>=0&&this.currentPageIndex<this.allPageCount-1||!o.isNext&&this.currentPageIndex>0&&this.currentPageIndex<=this.allPageCount)&&(0==i&&this.flipCutStart(o),this.renderCutPage(o)):(o.isNext&&this.currentPageIndex>=0&&this.currentPageIndex<this.allPageCount||!o.isNext&&this.currentPageIndex>0&&this.currentPageIndex<=this.allPageCount)&&(0==i&&this.flipCutStart(o),this.renderCutPage(o))}}return!0},t.prototype.culCoreData=function(t,i){var e=this.getTwoPointLong(t,i),s=this.getAngle(t,i);s<-57.29577951308232&&(s=-57),s>57.29577951308232&&(s=57);var o=2*Math.PI/360*s,a=e/2/Math.cos(o),n=2*Math.PI/360*(90-s),r=e/2/Math.cos(n),h=this.getBigRectWidth(),l={x:(this.width-a)*Math.cos(o)-h,y:t.y>=0&&t.y<=this.height?0:this.width*Math.tan(o)*Math.cos(o)},c={x:(this.width-a)*Math.cos(o)-e/2,y:(this.width-a)*Math.sin(o)+e/2*Math.tan(o)};return{distance:e,angle:s,hd:o,containerMove:l,pageMove:c,xDistance:a,yDistance:r}},t.prototype.checkIsValidMove=function(t,i,e){var s=this.getBigRectWidth(),o=this.getDiagonalPoint(t.direct),a=this.getTwoPointLong(o,i);return!(e>this.width||a>s)},t.prototype.getCurrentCutPageData=function(i,e,s,o,a){var n={sp:a,angle:i,distance:o};n.fbCP={left:0,right:0},n.fbCOrigin={x:0,y:0},n.fbCTransfrom={x:0,y:0},n.fbCAngle=i,n.fbPTransform1={x:0,y:0},n.fbPTransform2={x:0,y:0},n.fbPAngle=i;var r=this.getBigRectWidth();switch(this._referPoint.direct){case t.TouchPostion.RightTop:n.pLeft=this.isSinglePage()?0:this.width,n.fbCP={left:0,top:0},n.fbCOrigin={x:0,y:0},n.fbCTransfrom={x:e.x,y:e.y},n.fbCAngle=-i,n.fbPTransform1={x:-e.x,y:-e.y},n.fbPTransform2={x:s.x,y:s.y},n.fbPAngle=-i,n.isNext=!0;break;case t.TouchPostion.RightBottom:n.pLeft=this.isSinglePage()?0:this.width,n.fbCP={left:0,top:this.height-r},n.fbCOrigin={x:0,y:100},n.fbCTransfrom={x:e.x,y:e.y},n.fbCAngle=-i,n.fbPTransform1={x:-e.x,y:-e.y+r-this.height},n.fbPTransform2={x:s.x,y:s.y},n.fbPAngle=-i,n.isNext=!0;break;case t.TouchPostion.LeftTop:n.pLeft=0,n.fbCP={left:this.width-r,top:0},n.fbCOrigin={x:100,y:0},n.fbCTransfrom={x:-e.x,y:e.y},n.fbCAngle=i,n.fbPTransform1={x:-this.width,y:e.y},n.fbPTransform2={x:o/2,y:Math.abs(s.y)},n.fbPAngle=i,n.isNext=!1;break;case t.TouchPostion.LeftBottom:n.pLeft=0,n.fbCP={left:this.width-r,top:this.height-r},n.fbCOrigin={x:100,y:100},n.fbCTransfrom={x:-e.x,y:e.y},n.fbCAngle=i,n.fbPTransform1={x:-this.width,y:-e.y+r-this.height},n.fbPTransform2={x:o/2,y:s.y},n.fbPAngle=i,n.isNext=!1;break;default:return null}return n},t.prototype.flipCutStart=function(t){this.isNext=t.isNext,this.onPageFlipStart&&this.onPageFlipStart(),this.pageList.forEach(function(t){console.log("item",t),t&&t.hide().css("z-index",0)});var i=this.isSinglePage(),e=t.isNext?this.currentPageIndex:this.currentPageIndex-1,s=t.isNext?e+1:e-1,o=t.isNext?s+1:s-1,a=this.pageList[s]||this.onPageMissing&&this.onPageMissing.call(this,s);if(i?(e=this.currentPageIndex,a=this._BlankPage,o=t.isNext?e+1:e-1):null!=this.lastPageIndex?t.isNext?(this.pageList[this.lastPageIndex-1]&&this.pageList[this.lastPageIndex-1].show().css("z-index",0),this.pageList[this.lastPageIndex]&&this.pageList[this.lastPageIndex].hide().css("z-index",7)):(this.pageList[this.lastPageIndex-1]&&this.pageList[this.lastPageIndex-1].show().css("z-index",0),this.pageList[this.lastPageIndex]&&this.pageList[this.lastPageIndex].show().css("z-index",7)):(this.pageList[this.currentPageIndex-1]&&this.pageList[this.currentPageIndex-1].show().css("z-index",9),this.pageList[this.currentPageIndex]&&this.pageList[this.currentPageIndex].show().css("z-index",9)),!a)return void console.warn("No next page.");var n=this.pageList[e]||this.onPageMissing&&this.onPageMissing.call(this,e),r=this.pageList[o]||this.onPageMissing&&this.onPageMissing.call(this,o);n.show().css("z-index",9),a.show().css("z-index",10),r&&r.show().css("z-index",7)},t.prototype.renderCutPage=function(r){this.isNext=r.isNext;var h=this.isSinglePage(),l=r.isNext?this.currentPageIndex:this.currentPageIndex-1,c=r.isNext?l+1:l-1,p=r.isNext?c+1:c-1,d=this.pageList[c]||this.onPageMissing&&this.onPageMissing.call(this,c);if(h&&(l=this.currentPageIndex,d=this._BlankPage,p=r.isNext?l+1:l-1),!d)return void console.warn("No next page for render.");var g=this.pageList[l]||this.onPageMissing&&this.onPageMissing.call(this,l),f=this.pageList[p]||this.onPageMissing&&this.onPageMissing.call(this,p);if(g.css("left",r.pLeft+"px"),g.FBContainer.css("left",r.fbCP.left+"px").css("top",r.fbCP.top+"px"),g.FBContainer.css("transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBContainer.css("-ms-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBContainer.css("-moz-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBContainer.css("-webkit-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBContainer.css("-o-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBContainer.css(e,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),g.FBContainer.css(s,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),g.FBContainer.css(o,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),g.FBContainer.css(a,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),g.FBContainer.css(n,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),g.FBPage.css("transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBPage.css("-ms-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBPage.css("-moz-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBPage.css("-webkit-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),g.FBPage.css("-o-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),r.isNext)g.FBPage.css(e,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(s,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(o,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(a,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(n,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)");else{var _=0;1==this._referPoint.direct?_=-(r.fbCTransfrom.y+this.height-this.getBigRectWidth()):0==this._referPoint.direct&&(_=r.fbCTransfrom.y<0?-r.fbCTransfrom.y:0);var m=-(r.fbCTransfrom.x+this.width-this.getBigRectWidth());g.FBPage.css(e,"translate3d("+m+"px, "+_+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(s,"translate3d("+m+"px, "+_+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(o,"translate3d("+m+"px, "+_+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(a,"translate3d("+m+"px, "+_+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)"),g.FBPage.css(n,"translate3d("+m+"px, "+_+"px, 0px) rotate("+(360-r.fbCAngle)+"deg)")}if(d.css("left",r.pLeft+"px"),d.FBContainer.css("left",r.fbCP.left+"px").css("top",r.fbCP.top+"px"),d.FBContainer.css("transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBContainer.css("-ms-transform",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBContainer.css("-moz-transform",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBContainer.css("-webkit-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBContainer.css("-o-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBContainer.css(e,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),d.FBContainer.css(s,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),d.FBContainer.css(o,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),d.FBContainer.css(a,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),d.FBContainer.css(n,"rotate("+r.fbCAngle+"deg) translate3d("+r.fbCTransfrom.x+"px, "+r.fbCTransfrom.y+"px, 0px)"),d.FBPage.css("transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBPage.css("-ms-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBPage.css("-moz-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBPage.css("-webkit-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBPage.css("-o-transform-origin",r.fbCOrigin.x+"% "+r.fbCOrigin.y+"% 0px"),d.FBPage.css(e,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) translate3d("+r.fbPTransform2.x+"px, "+r.fbPTransform2.y+"px, 0px) rotate("+r.fbPAngle+"deg)"),d.FBPage.css(s,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) translate3d("+r.fbPTransform2.x+"px, "+r.fbPTransform2.y+"px, 0px) rotate("+r.fbPAngle+"deg)"),d.FBPage.css(o,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) translate3d("+r.fbPTransform2.x+"px, "+r.fbPTransform2.y+"px, 0px) rotate("+r.fbPAngle+"deg)"),d.FBPage.css(a,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) translate3d("+r.fbPTransform2.x+"px, "+r.fbPTransform2.y+"px, 0px) rotate("+r.fbPAngle+"deg)"),d.FBPage.css(n,"translate3d("+r.fbPTransform1.x+"px, "+r.fbPTransform1.y+"px, 0px) translate3d("+r.fbPTransform2.x+"px, "+r.fbPTransform2.y+"px, 0px) rotate("+r.fbPAngle+"deg)"),f&&(f.css("left",r.pLeft+"px"),f.FBContainer.css("left","0px").css("top","0px"),f.FBContainer.css("transform-origin","0% 0% 0px"),f.FBContainer.css("-ms-transform-origin","0% 0% 0px"),f.FBContainer.css("-moz-transform-origin","0% 0% 0px"),f.FBContainer.css("-webkit-transform-origin","0% 0% 0px"),f.FBContainer.css("-o-transform-origin","0% 0% 0px"),f.FBContainer.css(e,"rotate(0deg) translate3d("+r.fbCP.left+"px, 0px, 0px)"),f.FBContainer.css(s,"rotate(0deg) translate3d("+r.fbCP.left+"px, 0px, 0px)"),f.FBContainer.css(o,"rotate(0deg) translate3d("+r.fbCP.left+"px, 0px, 0px)"),f.FBContainer.css(a,"rotate(0deg) translate3d("+r.fbCP.left+"px, 0px, 0px)"),f.FBContainer.css(n,"rotate(0deg) translate3d("+r.fbCP.left+"px, 0px, 0px)"),f.FBPage.css("transform-origin","0% 0% 0px"),f.FBPage.css("-ms-transform-origin","0% 0% 0px"),f.FBPage.css("-moz-transform-origin","0% 0% 0px"),f.FBPage.css("-webkit-transform-origin","0% 0% 0px"),f.FBPage.css("-o-transform-origin","0% 0% 0px"),f.FBPage.css(e,"rotate(0deg) translate3d("+r.fbCP.left*-1+"px, 0px, 0px)"),f.FBPage.css(s,"rotate(0deg) translate3d("+r.fbCP.left*-1+"px, 0px, 0px)"),f.FBPage.css(o,"rotate(0deg) translate3d("+r.fbCP.left*-1+"px, 0px, 0px)"),f.FBPage.css(a,"rotate(0deg) translate3d("+r.fbCP.left*-1+"px, 0px, 0px)"),f.FBPage.css(n,"rotate(0deg) translate3d("+r.fbCP.left*-1+"px, 0px, 0px)")),h&&(f.css("left","0px"),f.FBContainer.css("left","0px").css("top","0px"),f.FBContainer.css("transform-origin","0% 0% 0px"),f.FBContainer.css("-ms-transform-origin","0% 0% 0px"),f.FBContainer.css("-moz-transform-origin","0% 0% 0px"),f.FBContainer.css("-webkit-transform-origin","0% 0% 0px"),f.FBContainer.css("-o-transform-origin","0% 0% 0px"),f.FBContainer.css(e,"rotate(0deg) translate3d(0px, 0px, 0px)"),f.FBContainer.css(s,"rotate(0deg) translate3d(0px, 0px, 0px)"),f.FBContainer.css(o,"rotate(0deg) translate3d(0px, 0px, 0px)"),f.FBContainer.css(a,"rotate(0deg) translate3d(0px, 0px, 0px)"),f.FBContainer.css(n,"rotate(0deg) translate3d(0px, 0px, 0px)"),f.FBPage.css("transform-origin","0% 0% 0px"),f.FBPage.css("-ms-transform-origin","0% 0% 0px"),f.FBPage.css("-moz-transform-origin","0% 0% 0px"),f.FBPage.css("-webkit-transform-origin","0% 0% 0px"),f.FBPage.css("-o-transform-origin","0% 0% 0px"),f.FBPage.css(e,"translate3d(0px, 0px, 0px) translate3d(0px, 0px, 0px) rotate(0deg)"),f.FBPage.css(s,"translate3d(0px, 0px, 0px) translate3d(0px, 0px, 0px) rotate(0deg)"),f.FBPage.css(o,"translate3d(0px, 0px, 0px) translate3d(0px, 0px, 0px) rotate(0deg)"),f.FBPage.css(a,"translate3d(0px, 0px, 0px) translate3d(0px, 0px, 0px) rotate(0deg)"),f.FBPage.css(n,"translate3d(0px, 0px, 0px) translate3d(0px, 0px, 0px) rotate(0deg)")),!h&&(this.currentPageIndex>=this.allPageCount-2&&r.isNext||this.currentPageIndex<=3&&!r.isNext)||h&&(this.currentPageIndex>=this.allPageCount-1&&r.isNext||this.currentPageIndex<=0&&!r.isNext));else{var p,u=1-Math.abs(r.sp.x-this._referPoint.x)/(2*this.width),x=[[.4,"rgba(0,0,0,0)"],[.5,"rgba(0,0,0,"+.4*u+")"],[.6,"rgba(0,0,0,0)"]],b=[],y={x:this._referPoint.x/this._pageShadow.width()*100,y:this._referPoint.y/this._pageShadow.height()*100},v={x:r.sp.x/this._pageShadow.width()*100,y:r.sp.y/this._pageShadow.height()*100};if("-webkit-"==i)this._pageShadow.css("z-index",8).css("background-image","-webkit-gradient(linear, "+this._referPoint.x+" "+this._referPoint.y+", "+r.sp.x+" "+r.sp.y+", from(rgba(0, 0, 0, 0)),to(rgba(0, 0, 0, 0)), color-stop(0.4, rgba(0,0,0,0)), color-stop(0.5, rgba(0,0,0,"+.5*u+")), color-stop(0.6, rgba(0,0,0,0)))");else{var P={x:y.x/100*this._pageShadow.width(),y:y.y/100*this._pageShadow.height()},w={x:v.x/100*this._pageShadow.width(),y:v.y/100*this._pageShadow.height()},C=w.x-P.x,k=w.y-P.y,$=Math.atan2(k,C),F=$-Math.PI/2,T=Math.abs(this._pageShadow.width()*Math.sin(F))+Math.abs(this._pageShadow.height()*Math.cos(F)),B=Math.sqrt(k*k+C*C),S=t.Point(w.x<P.x?this._pageShadow.width():0,w.y<P.y?this._pageShadow.height():0),M=Math.tan($),I=-1/M,A=(I*S.x-S.y-M*P.x+P.y)/(I-M),l={x:A,y:I*A-I*S.x+S.y},L=Math.sqrt(Math.pow(l.x-P.x,2)+Math.pow(l.y-P.y,2));for(p=0;p<3;p++)b.push(" "+x[p][1]+" "+100*(L+B*x[p][0])/T+"%");this._pageShadow.css("z-index",8).css("background-image",""+i+"linear-gradient( "+-$+"rad,rgba(0, 0, 0, 0),rgba(0, 0, 0, 0),"+b.join(",")+")")}}var u=1-Math.abs(r.sp.x-this._referPoint.x)/(2*this.width),z=2*Math.PI/360*r.angle,O={x:r.fbCOrigin.x*this.width/100,y:r.fbCOrigin.y*this.height/100},D={x:r.distance/2*Math.cos(z),y:r.distance/2*Math.sin(z)+(this._referPoint.direct%2!=0?this.height:0)};this._referPoint.direct<2&&(D.x=this.width-D.x);var N=[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*u+")"],[1,"rgba(0,0,0,0)"]],W={x:O.x,y:O.y},R={x:D.x,y:D.y},E={x:W.x/this.width*100,y:W.y/this.height*100},H={x:R.x/this.width*100,y:R.y/this.height*100},b=[],U=[];if("-webkit-"==i){for(var V=0;V<3;V++)U.push("color-stop("+N[V][0]+", "+N[V][1]+")");d.FBLight.css("background-image","-webkit-gradient(linear, "+E.x+"% "+E.y+"%,"+H.x+"% "+H.y+"%, "+U.join(",")+" )")}else{for(var C=R.x-W.x,k=R.y-W.y,q=Math.atan2(k,C),F=q-Math.PI/2,T=Math.abs(this.width*Math.sin(F))+Math.abs(this.height*Math.cos(F)),B=Math.sqrt(k*k+C*C),S=t.Point(R.x<W.x?this.width:0,R.y<W.y?this.height:0),M=Math.tan(q),I=-1/M,A=(I*S.x-S.y-M*W.x+W.y)/(I-M),l={x:A,y:I*A-I*S.x+S.y},L=Math.sqrt(Math.pow(l.x-W.x,2)+Math.pow(l.y-W.y,2)),V=0;V<3;V++)b.push(" "+N[V][1]+" "+100*(L+B*N[V][0])/T+"%");d.FBLight.css("background-image",""+i+"linear-gradient("+-q+"rad,"+b.join(",")+")")}},t.prototype.getDiagonalPoint=function(i){var e=new t.Point(0,0);switch(i){case t.TouchPostion.LeftTop:e.x=this.width,e.y=this.height;break;case t.TouchPostion.LeftBottom:e.x=this.width,e.y=0;break;case t.TouchPostion.RightTop:e.x=this.isSinglePage()?0:this.width,e.y=this.height;break;case t.TouchPostion.RightBottom:e.x=this.isSinglePage()?0:this.width,e.y=0;break;default:e=null}return e},t.prototype.getStagePoint=function(i){var e=i.type.indexOf("touch")!=-1,s=e?i.originalEvent.changedTouches[0].pageX:i.pageX,o=e?i.originalEvent.changedTouches[0].pageY:i.pageY,a=this.fbStage.offset();return new t.Point(s-a.left,o-a.top)},t.prototype.getTwoPointLong=function(t,i){var e=t.x-i.x,s=t.y-i.y;return Math.sqrt(Math.pow(e,2)+Math.pow(s,2))},t.prototype.getBigRectWidth=function(){return this._FBBigRectWidth||(this._FBBigRectWidth=Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))),this._FBBigRectWidth},t.prototype.getAngle=function(t,i){var e=t.x-i.x,s=t.y-i.y,o=Math.sqrt(Math.pow(e,2)+Math.pow(s,2));return 0==o?0:Math.asin(s/o)/Math.PI*180},t.prototype.getPrefix=function(){for(var t=["Moz","Webkit","Khtml","O","ms"],i=t.length,e="";i--;)t[i]+"Transform"in document.body.style&&(e="-"+t[i].toLowerCase()+"-");
return e},t.prototype.onPageFlipStart=function(t){console.log("1111n",t),console.log("aaaa",this);var i,e=this.currentPageIndex,s=this.allPageCount;if(this.isNext&&e+1<s)for(var o=e;o<=e+3;o++)o>0&&o<s&&!$("#page"+o)[0]&&(i=document.createElement("div"),i.setAttribute("id","page"+o),this.addPage(i,o),$("#page"+o).html(this.bookTemplate(o)));else if(!this.isNext&&e-1>=0)for(var o=e-1;o>=e-3;o--)o>=0&&!$("#page"+o)[0]&&(i=document.createElement("div"),i.setAttribute("id","page"+o),this.addPage(i,o),$("#page"+o).html(this.bookTemplate(o)));this.isNext&&e!==s?this.pageList[e+1]&&this.pageList[e+1].FBPage.css("box-shadow","rgba(0, 0, 0, 0.2) 0px 0px 20px"):this.pageList[e-2]&&this.pageList[e-2].FBPage.css("box-shadow","rgba(0, 0, 0, 0.2) 0px 0px 20px")},t.prototype.onPageFlipEnd=function(){var t=this.currentPageIndex;this.allPageCount;console.log("currentIndex",t),slider.update({from:t});var i=this.isNext?t:t-1;this.pageList[i]?this.pageList[i].css("z-index",11):null;for(var e=0,s=this.pageList.length;e<s;e++)this.pageList[e]&&(e<t-3||e>t+2)&&this.deletePageDom(e);null!=this.lastPageIndex&&(this.pageList[this.lastPageIndex]&&this.pageList[this.lastPageIndex].hide(),this.lastPageIndex=null),this.isNext&&0!==t?this.pageList[t-1]&&this.pageList[t-1].FBPage.css("box-shadow","none"):this.pageList[t]&&this.pageList[t].FBPage.css("box-shadow","none"),this.pageList[t]&&this.pageList[t].find("img.imgLoading").lazyload({effect:"fadeIn"}),this.pageList[t-1]&&this.pageList[t-1].find("img.imgLoading").lazyload({effect:"fadeIn"})},t.prototype.onPageMissing=function(t){if(console.log("pageIndex",t),t>=0&&t<this.allPageCount&&!$("#page"+t)[0]){var i=document.createElement("div");return i.setAttribute("id","page"+t),this.addPage(i,t),$("#page"+t).html(this.bookTemplate(t)),this.pageList[t]}if($("#page"+t)[0])return $("#page"+t).parents(".FBPage")},t.prototype.bookTemplate=function(t){function i(t){switch(t){case 3:return 180;case 6:return 90;case 8:return 270;default:return 0}}var e=this._bookData.podData,s=this._bookData;console.log("this",this.width);var o=$('<div class="page"></div>');if(s.editUrl&&4!=e[t].content_type&&5!=e[t].content_type){var a=$('<a class="tf_btn" href="'+s.editUrl+"?page="+t+"&contentType="+e[t].content_type+'">编辑当前页面</a>');a.css({position:"absolute",background:"rgba(0,0,0,.8)",color:"#fff",fontSize:"14px",borderRadius:"4px",cursor:"pointer",width:"120px",textAlign:"center",height:"30px",lineHeight:"30px",left:"50%",zIndex:"30",marginLeft:"-60px",top:"50%",marginTop:"15px",display:"none",textDecoration:"none"}),a.appendTo(o),$(".FBPage").hover(function(){$(this).find(".tf_btn").show()},function(){$(this).find(".tf_btn").hide()})}if(t>0&&t<s.allPageCount&&this._bookData.isSinglePage&&(t%2?o.addClass("even"):o.addClass("odd")),console.log("n111",t),e[t].element_list.length>0)for(var n=0;n<e[t].element_list.length;n++){var r=e[t].element_list[n],h=$('<div class="page_center_list podPage_'+t+'"></div>'),l=$('<div class="imgBox"></div>'),c=$('<img class="imgLoading"  />'),p=r.image_content_expand,d=p.image_rotation,g=p.image_rotation+i(p.image_orientation),f=Math.floor(r.element_width*s.ratioWidth),_=Math.floor(r.element_height*s.ratioHeight),m={};if(h.css({width:f<1?1:f,height:_<1?1:_,position:"absolute",top:r.element_top*s.ratioHeight,left:r.element_left*s.ratioWidth,overflow:"hidden",backgroundImage:r.element_background?"url("+r.element_background+")":"none",backgroundSize:"100%",zIndex:r.element_depth,transform:"rotate("+r.element_rotation+"deg)"}),r.element_mask_image){var u=r.element_width*s.ratioWidth-(r.element_content_left+r.element_content_right+p.image_padding_left)*s.ratioWidth,x=r.element_height*s.ratioHeight-(r.element_content_top+r.element_content_bottom+p.image_padding_top)*s.ratioHeight,b=(p.image_padding_top+p.image_start_point_y)*s.ratioHeight,y=(p.image_padding_left+p.image_start_point_x)*s.ratioWidth,v=p.image_width*p.image_scale*s.ratioWidth,P=p.image_height*p.image_scale*s.ratioHeight;90!=g&&270!=g||(v=p.image_height*p.image_scale*s.ratioHeight,P=p.image_width*p.image_scale*s.ratioWidth);var w=$("<svg id='svg_mask_wrap"+t+"' width='"+u+"' height='"+x+"' baseProfile='full' version='1.2'><defs><mask id='svg_mask_"+t+"' maskUnits='userSpaceOnUse' maskContentUnits='userSpaceOnUse'transform='scale(1)'><image fill='black' width='"+u+"' height='"+x+"' xlink:href='"+r.element_mask_image+"' /></mask></defs><image mask='url(#svg_mask_"+t+")'  y='"+b+"' x='"+y+"' width='"+v+"' height='"+P+"'  xlink:href='"+r.image_content_expand.image_url+"@"+p.image_rotation+"r_2o' /><rect mask='url(#svg_mask_"+t+")' x='0' y='0' width='100%' height='100%'  class='svg_hover_style'  fill='#000000' opacity='0'/></svg>");w.appendTo(l)}switch(l.css({top:Math.floor(r.element_content_top*s.ratioWidth),left:Math.floor(r.element_content_left*s.ratioHeight),right:Math.floor(r.element_content_right*s.ratioHeight),bottom:Math.floor(r.element_content_bottom*s.ratioWidth),position:"absolute",overflow:"hidden"}),l.appendTo(h),r.element_type){case 1:r.element_deleted||(r.element_content||h.css({display:"none"}),r.element_mask_image||(c.attr({"data-original":p.image_url+"@"+d+"r_2o"}),90==g||270==g?(m.width=Math.floor(p.image_height*s.ratioHeight)*p.image_scale,m.height=Math.floor(p.image_width*s.ratioWidth)*p.image_scale):(m.width=Math.floor(p.image_width*s.ratioWidth)*p.image_scale,m.height=Math.floor(p.image_height*s.ratioHeight)*p.image_scale),c.css({width:m.width,height:m.height,top:Math.floor(p.image_padding_top+p.image_start_point_y)*s.ratioHeight,left:Math.floor(p.image_padding_left+p.image_start_point_x)*s.ratioWidth,position:"absolute"}),c.appendTo(l)));break;case 5:if(!r.element_deleted){c.attr({"data-original":p.image_url});var C=Math.floor(Math.floor(p.image_width*s.ratioWidth)*p.image_scale),k=Math.floor(Math.floor(p.image_height*s.ratioHeight)*p.image_scale);c.css({width:C<1?1:C,height:k<1?1:k,top:Math.floor((p.image_padding_top+p.image_start_point_y)*s.ratioHeight),left:Math.floor((p.image_padding_left+p.image_start_point_x)*s.ratioWidth),position:"absolute"}),c.appendTo(l)}break;case 2:console.log("liStyle",r),r.element_deleted||(c.attr({"data-original":p.image_url}),c.css({width:Math.floor(p.image_width*s.ratioWidth)*p.image_scale,height:Math.floor(p.image_height*s.ratioHeight)*p.image_scale,top:(p.image_padding_top+p.image_start_point_y)*s.ratioHeight,left:(p.image_padding_left+p.image_start_point_x)*s.ratioWidth,position:"absolute"}),c.appendTo(l))}h.appendTo(o)}return o.css({"background-image":"url("+e[t].page_image+")","background-color":e[t].page_color,"background-size":"100%",width:s.width+"px",height:s.height+"px",position:"relative"})},t.prototype.initTemplate=function(t){var i=this._bookData,e=this;console.log("that.zoomScale",e.zoomScale),$("#bookShadow").css({width:i.width+"px",height:i.height+"px"}),$("#main,#pageList").css({width:2*i.width+"px",height:i.height+"px"});var s=this.bookTemplate(t),o=this._bookData.container;s.appendTo(o),$("img.imgLoading").lazyload({effect:"fadeIn"}),setTimeout(function(){$(".FBPage").hover(function(){$(this).find(".tf_btn").show()},function(){$(this).find(".tf_btn").hide()})},100)},t.prototype.initSilider=function(){var t=this._bookData,i=this,e=$('<div class="range_slider" ><input type="text" id="example_id" name="example_name" value="" /></div>');e.appendTo("#main");var s,o="[data-rangeSlider]";document.querySelectorAll(o);$("#example_id").ionRangeSlider({min:0,max:t.allPageCount-1,from:0,type:"single",onChange:function(t){},onFinish:function(e){console.log("that",i.ratioHeight);var o,a=e.from,n=a>i.currentPageIndex;o=n?a-i.currentPageIndex==1?a:a-1:a-i.currentPageIndex==-1||a-i.currentPageIndex==-2?a+1:a+2,s=1==i.zoomScale?{x:n?2*i.width-100:100*i.ratioWidth,y:i.height-150*i.ratioHeight}:{x:n?i.width-100*i.zoomScale:100*i.zoomScale,y:i.height-150*i.zoomScale},i.currentPageIndex!=a&&i.currentPageIndex!=o&&(i.lastPageIndex=i.currentPageIndex,o%2>0&&1==i.zoomScale?n?i.currentPageIndex=o-1:i.currentPageIndex=o+1:0==a?i.currentPageIndex=1==i.zoomScale?a+2:a+1:a==t.allPageCount?i.currentPageIndex=1==i.zoomScale?a-2:a-1:i.currentPageIndex=o,i.keyTouch(s))},prettify:function(e){if(0==e)return"封面";if(e==t.allPageCount-1)return"封底";console.log("页面样式",i._bookData);var s=i._bookData.podData;return 8==s[i.currentPageIndex].content_type?"扉页":9==s[i.currentPageIndex].content_type?"寄语":4==s[i.currentPageIndex].content_type?"封面":5==s[i.currentPageIndex].content_type?"封底":e-i.startIndex+1}}),window.slider=$("#example_id").data("ionRangeSlider")},t.prototype.aboutFlip=function(t){if("next"==t){var i={x:2*this.width-100*this.ratioHeight,y:this.height-150*this.ratioHeight};this.keyTouch(i)}if("previous"==t){var i={x:100*this.ratioWidth,y:this.height-150*this.ratioHeight};this.keyTouch(i)}},window.Timeface=window.Timeface||{},Timeface.FlipBook=t}(),function(t,i,e,s){var o=t(i);t.fn.lazyload=function(a){function n(){var i=0;h.each(function(){var e=t(this);if(!l.skip_invisible||e.is(":visible"))if(t.abovethetop(this,l)||t.leftofbegin(this,l));else if(t.belowthefold(this,l)||t.rightoffold(this,l)){if(++i>l.failure_limit)return!1}else e.trigger("appear"),i=0})}var r,h=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:i,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return a&&(s!==a.failurelimit&&(a.failure_limit=a.failurelimit,delete a.failurelimit),s!==a.effectspeed&&(a.effect_speed=a.effectspeed,delete a.effectspeed),t.extend(l,a)),r=l.container===s||l.container===i?o:t(l.container),0===l.event.indexOf("scroll")&&r.on(l.event,function(){return n()}),this.each(function(){var i=this,e=t(i);i.loaded=!1,e.attr("src")!==s&&e.attr("src")!==!1||e.is("img")&&e.attr("src",l.placeholder),e.one("appear",function(){if(!this.loaded){if(l.appear){var s=h.length;l.appear.call(i,s,l)}t("<img />").one("load",function(){var s=e.attr("data-"+l.data_attribute);e.hide(),e.is("img")?e.attr("src",s):e.css("background-image","url('"+s+"')"),e[l.effect](l.effect_speed),i.loaded=!0;var o=t.grep(h,function(t){return!t.loaded});if(h=t(o),l.load){var a=h.length;l.load.call(i,a,l)}}).attr("src",e.attr("data-"+l.data_attribute))}}),0!==l.event.indexOf("scroll")&&e.on(l.event,function(){i.loaded||e.trigger("appear")})}),o.on("resize",function(){n()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&o.on("pageshow",function(i){i.originalEvent&&i.originalEvent.persisted&&h.each(function(){t(this).trigger("appear")})}),t(e).ready(function(){n()}),this},t.belowthefold=function(e,a){var n;return n=a.container===s||a.container===i?(i.innerHeight?i.innerHeight:o.height())+o.scrollTop():t(a.container).offset().top+t(a.container).height(),n<=t(e).offset().top-a.threshold},t.rightoffold=function(e,a){var n;return n=a.container===s||a.container===i?o.width()+o.scrollLeft():t(a.container).offset().left+t(a.container).width(),n<=t(e).offset().left-a.threshold},t.abovethetop=function(e,a){var n;return n=a.container===s||a.container===i?o.scrollTop():t(a.container).offset().top,n>=t(e).offset().top+a.threshold+t(e).height()},t.leftofbegin=function(e,a){var n;return n=a.container===s||a.container===i?o.scrollLeft():t(a.container).offset().left,n>=t(e).offset().left+a.threshold+t(e).width()},t.inviewport=function(i,e){return!(t.rightoffold(i,e)||t.leftofbegin(i,e)||t.belowthefold(i,e)||t.abovethetop(i,e))},t.extend(t.expr[":"],{"below-the-fold":function(i){return t.belowthefold(i,{threshold:0})},"above-the-top":function(i){return!t.belowthefold(i,{threshold:0})},"right-of-screen":function(i){return t.rightoffold(i,{threshold:0})},"left-of-screen":function(i){return!t.rightoffold(i,{threshold:0})},"in-viewport":function(i){return t.inviewport(i,{threshold:0})},"above-the-fold":function(i){return!t.belowthefold(i,{threshold:0})},"right-of-fold":function(i){return t.rightoffold(i,{threshold:0})},"left-of-fold":function(i){return!t.rightoffold(i,{threshold:0})}})}(jQuery,window,document);